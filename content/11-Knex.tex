\section{Knex.js}
Knex.js is a~highly popular and versatile query builder in the JavaScript and
TypeScript ecosystem, with a~substantial following of 1,346,100 weekly downloads
and 17,419 stars on GitHub. Initially developed by Tim Griesser
\cite{KnexCommits}, it has since grown to involve numerous contributors actively
participating in its maintenance and development. Its popularity statistics may
be skewed, as the package is used in various ORMs, such as Bookshelf.js and
Objection.js, contributing to its download count.

One of the key strengths of Knex.js is its broad support for a~wide range of
databases, including but not limited to PostgreSQL, Oracle Database,
CockroachDB, and Amazon Redshift. This flexibility extends to accommodating
multiple drivers for databases like PostgreSQL and MySQL, where several popular
drivers exist. With this extensive compatibility, Knex.js caters to a~diverse
audience of developers working with different databases and drivers
\cite{knexDocumentation}.

\newpage

Knex.js offers non-abstracted function-based query building, representing each
SQL term with a~function call. This approach allows developers to construct
queries in a~granular and modular manner. This all while keeping the syntax
quite reminiscent of SQL syntax as shown by comparison in
\autoref{lst:knexCompareSQL}. The package also supports type templating and
table definitions, which can be autogenerated using the \texttt{knex-types}
\cite{knexTypes} package, further streamlining the development process.

\begin{listing}
    \caption{Knex query composition compared to resulting SQL}
    \label{lst:knexCompareSQL}
\begin{minted}{typescript}
// Knex query creation and request
await knexInstance
    select<Array<{ toy_name: string }>>('toy.toy_name')
    .from('toy')
    .join('toy_house', 'toy_house.toy_id', 'toy.id')
    .join('house_cat', 'house_cat.house_id', 'toy_house.house_id')
    .where('house_cat.cat_id', '=', id)
\end{minted} 

\vspace{-\medskipamount}
\vspace{-0.5\baselineskip}

\begin{minted}{postgresql}
-- Resulting SQL
SELECT
    toy.toy_name
FROM
    toy
JOIN toy_house ON toy_house.toy_id = toy.id
JOIN house_cat ON house_cat.house_id = toy_house.id
WHERE
    house_cat.cat_id = $1;
\end{minted}    
\end{listing}

However, Knex.js faces limitations in type guarantees due to its benevolent
implementation in JavaScript and having separately written types. These
constraints result in type support not extending to more advanced features, such
as join suggestions or multi-table joins, potentially limiting the package's
utility in more complex scenarios. Additionally, when the \texttt{.first()}
method is called, Knex.js does not automatically assume that the query is
fetching single and not multiple objects, leaving the typing responsibility to
the developer.

Compatibility-wise, Knex.js is built to work seamlessly with both ES module and
CommonJS syntax, ensuring its usefulness across various development
environments. The package is licensed under the MIT Licence.

% \newpage

Although Knex.js benefits from active support for its basic functionality, the
vast range of databases it supports inevitably leads to a~considerable upkeep.
Consequently, many bugs remain unaddressed for extended periods, potentially
impacting developers who rely on the package for their projects.

Regarding documentation, Knex.js stands out with high-quality online resources,
guiding users through setup and usage. As with many other packages in this
comparison, the documentation is created using \texttt{vitepress} package and
has excellent readability and searchability. However, the package does not have
annotated types or function calls, which may result in developers needing to
refer back to the online documentation more frequently than desired.

The package has several dependencies, mostly utility packages, such as
\texttt{colorette} for styling command line output or \texttt{lodash} for
collection and advanced data structures manipulation. While Knex is inflating
the download numbers of these packages by a~significant amount, they are also
popular and supported on their own accord. None seem to have any outstanding or
long-lasting issues.

\subsection*{Performance in benchmarks}

The package evaluation demonstrated the ability to formulate queries for the
benchmarks as flexibly as the SQL language. However, a~notable limitation was
its inability to accommodate operators with the \texttt{?} character
\cite{knexJSONIssue1}. This issue arises due to the package's utilization of
\texttt{?} as a~parameter replacement character. Consequently, this poses
challenges for PostgreSQL when checking key existence in \texttt{JSONB} data types and
even generates complications in Oracle databases when conducting regex
comparisons, as documented in issue \#3112 \cite{knexJSONIssue2} on the Knex
GitHub repository. Despite its persistence since at least 2019, no resolution
for this issue appears imminent.

Regarding type checking, the typing offered by Knex.js is insufficient for
TypeScript projects at best. Consequently, calls to the package are almost
equivalent to manually composing the query. Furthermore, many methods are
specific to the database engine and offer minimal abstraction, necessitating
frequent consultation of the package's high-quality documentation.
